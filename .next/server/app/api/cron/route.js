(()=>{var e={};e.id=557,e.ids=[557],e.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},71396:e=>{"use strict";e.exports=require("undici")},39491:e=>{"use strict";e.exports=require("assert")},50852:e=>{"use strict";e.exports=require("async_hooks")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},6005:e=>{"use strict";e.exports=require("node:crypto")},84492:e=>{"use strict";e.exports=require("node:stream")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},63477:e=>{"use strict";e.exports=require("querystring")},12781:e=>{"use strict";e.exports=require("stream")},71576:e=>{"use strict";e.exports=require("string_decoder")},24404:e=>{"use strict";e.exports=require("tls")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},87529:()=>{},70260:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>y,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h});var a={};r.r(a),r.d(a,{GET:()=>f,dynamic:()=>p});var s=r(49303),o=r(88716),i=r(60670),n=r(87070),c=r(19817),l=r(95908),u=r(18867);let p="force-dynamic";async function f(){let e=await (0,l.f7)(),t=Array.from(new Set(Object.values(e).flatMap(e=>e.teams)));if(0===t.length)return n.NextResponse.json({ok:!0,message:"No subscribers yet."});let r=await (0,c.R7)(t),a=await (0,l.VR)(),s=await (0,l.Yo)(),o={},i={},p={},f={};for(let e of t){let t=r[e]??[],n=t.map(e=>e.hash),c=new Set(a[e]??[]),l=s[e]??[],u=t.filter(e=>!c.has(e.hash)),d=function(e,t){let r=[],a=new Map(e.filter(e=>e.dateISO).map(e=>[e.dateISO,e]));for(let[e,s]of new Map(t.filter(e=>e.dateISO).map(e=>[e.dateISO,e]))){let t=a.get(e);t&&t.opponent!==s.opponent&&r.push({type:"opponent_changed",previous:t,current:s})}let s=new Map(e.map(e=>[e.opponent+"|"+e.team,e]));for(let[e,a]of new Map(t.map(e=>[e.opponent+"|"+e.team,e]))){let t=s.get(e);t&&t.dateISO!==a.dateISO&&r.push({type:"time_changed",previous:t,current:a})}let o=new Set(e.map(e=>e.hash)),i=new Set(t.map(e=>e.hash));for(let e of t)o.has(e.hash)||r.push({type:"added",current:e});for(let t of e)i.has(t.hash)||r.push({type:"removed",previous:t});return r}(l,t);if(u.length||d.length){let r=new Set;for(let e of d)("added"===e.type||"time_changed"===e.type||"opponent_changed"===e.type)&&r.add((e.type,e.current.hash));let a=new Map(t.map(e=>[e.hash,e]));o[e]=Array.from(r).map(e=>a.get(e)).filter(Boolean),i[e]=d}p[e]=n,f[e]=t}return Object.keys(o).length&&(await (0,u.sj)(e,o),await (0,l.cg)(p),await (0,l.tv)(f)),n.NextResponse.json({ok:!0,teams:t,changes:Object.keys(o).length,diffsByTeam:i})}let d=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/cron/route",pathname:"/api/cron",filename:"route",bundlePath:"app/api/cron/route"},resolvedPagePath:"D:\\git\\amfb-notifier\\app\\api\\cron\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:g}=d,x="/api/cron/route";function y(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}},18867:(e,t,r)=>{"use strict";r.d(t,{Xt:()=>n,sj:()=>l});var a=r(53194),s=r(5558),o=r.n(s);let i=process.env.RESEND_API_KEY?new a.R(process.env.RESEND_API_KEY):null;async function n(e,t){if(!i)return console.log("❌ Resend not configured"),!1;let r=`[AMFB] Confirmare abonare - Notificări program`,a=t.join(", "),s=`Salut!

Abonarea ta la notificările AMFB a fost \xeenregistrată cu succes!

Echipele pentru care vei primi notificări: ${a}

Vei fi notificat c\xe2nd se schimbă programul pentru aceste echipe.

Pentru a te dezabona, accesează: https://amfb-notifier.vercel.app

Mulțumim!
Echipa AMFB Notifier`;try{console.log("\uD83D\uDCE7 Sending email to:",e),console.log("\uD83D\uDCE7 From:",process.env.RESEND_FROM),console.log("\uD83D\uDCE7 API Key exists:",!!process.env.RESEND_API_KEY),console.log("\uD83D\uDCE7 Teams:",t);let a=await i.emails.send({from:process.env.RESEND_FROM||"AMFB Notifier <onboarding@resend.dev>",to:e,subject:r,text:s});if(console.log("✅ Email API response:",JSON.stringify(a,null,2)),a&&a.data&&a.data.id)return console.log("✅ Email sent successfully with ID:",a.data.id),!0;return console.error("⚠️ Unexpected email response:",a),!1}catch(e){return console.error("❌ Failed to send email:",e),console.error("❌ Error details:",JSON.stringify(e,null,2)),!1}}async function c(e,t,r){if(!i)return;let a=`[AMFB] Program actualizat pentru ${t}`,s=r.map(e=>`• ${t} vs ${e.opponent} - ${new Date(e.dateISO).toLocaleString("ro-RO")}`).join("\n");await i.emails.send({from:process.env.RESEND_FROM||"AMFB Notifier <notify@adrianconstantin.ro>",to:e,subject:a,text:`S-au detectat schimbări:
${s}

Link: https://amfb.ro/competitii/campionat-minifotbal/grupa-2013-albastru/`})}async function l(e,t){for(let[,r]of Object.entries(e))for(let e of r.teams){let a=t[e];a?.length&&r.email&&await c(r.email,e,a)}}process.env.TWILIO_SID&&process.env.TWILIO_TOKEN&&o()(process.env.TWILIO_SID,process.env.TWILIO_TOKEN)},19817:(e,t,r)=>{"use strict";r.d(t,{AC:()=>u,R7:()=>f});var a=r(74666),s=r(16727),o=r(34077),i=r(92685),n=r(6113),c=r.n(n);let l="https://amfb.ro/competitii/campionat-minifotbal/grupa-2013-albastru/";async function u(){try{console.log("\uD83D\uDD0D Fetching teams from AMFB...");let e=await fetch(l,{headers:{"user-agent":"Mozilla/5.0 AMFB-Notifier"}});if(!e.ok)return console.error("❌ Failed to fetch:",e.status),p();let t=await e.text(),r=a.zD(t),s=new Set,o=r("body").text(),i=p();for(let e of i)for(let t of[e,e.replace(/\.$/,""),e+".",e.replace(/\s+/g,"")])if(RegExp(`\\b${t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`,"gi").test(o)){s.add(e);break}for(let e of o.split("\n").map(e=>e.trim()).filter(Boolean))if(e.includes(":")&&/\d{1,2}:\d{2}/.test(e)){let t=e.replace(/\d{1,2}:\d{2}/g," ").replace(/\b(rezultat|etapa|data|duminica|sambata|ora)\b/gi," ").replace(/\b\d+\b/g," ").replace(/[\/\(\)\-–]/g," ").replace(/\s+/g," ").trim();for(let e of i){RegExp(`\\b${e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`,"gi").test(t)&&s.add(e);let r=e.replace(/\./g,"");r!==e&&RegExp(`\\b${r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`,"gi").test(t)&&s.add(e)}}let n=Array.from(s).sort((e,t)=>e.localeCompare(t,"ro"));return console.log("✅ Found teams:",n.length,n),n.length>0?n:p()}catch(e){return console.error("❌ Error fetching teams:",e),p()}}function p(){return["DNG","Sport Team","Alex. Vaidean","Dan Chilom","Marius L.","Raiders","Real Sport","ACS Juniorul 2014","Metaloglobus","Partizan","Academic","Acad MCR","D'angelo","Derby"]}async function f(e){let t=await fetch(l,{headers:{"user-agent":"Mozilla/5.0 AMFB-Notifier"}}),r=await t.text(),n=a.zD(r),u=n("table tr"),p=[];u.each((e,t)=>{let r;let a=n(t).find("td");if(a.length<3)return;let s=n(a[0]).text().trim(),o=n(a[1]).text().trim(),i=n(a[2]).text().trim(),c=o.split("-").map(e=>e.trim());if(c.length<2)return;let[l,u]=c,f=s.match(/(\d{2})\.(\d{2})\.(\d{4})\s+(\d{2}):(\d{2})/);if(f){let[e,t,a,s,o,i]=f;r=`${s}-${a}-${t}T${o}:${i}:00+03:00`}l&&u&&p.push({teamA:l,teamB:u,dateISO:r,location:i})});let f=new Date,d=(0,s.b)(f),m={};for(let t of e)m[t]=[];for(let t of p){let r=[t.teamA,t.teamB];for(let a of e){var h;let e=r.findIndex(e=>e.toLowerCase().includes(a.toLowerCase()));if(-1===e)continue;let s=r[1-e];if(t.dateISO){let e=new Date(t.dateISO);if(!(0,o.A)((0,i.T)(e,0),d))continue}let n={team:a,opponent:s,dateISO:t.dateISO??"",location:t.location,hash:(h=t.dateISO,c().createHash("sha1").update(`${a}|${s}|${h??""}`).digest("hex"))};m[a].push(n)}}return m}},95908:(e,t,r)=>{"use strict";r.d(t,{AL:()=>c,VF:()=>n,VR:()=>p,Yo:()=>d,cg:()=>f,f7:()=>l,tv:()=>m,wA:()=>u});let a=new(r(46343)).s({url:process.env.KV_REST_API_URL,token:process.env.KV_REST_API_TOKEN}),s="subs",o="last_fixtures",i="last_fixtures_full";async function n(e,t){await a.hset(s,{[e]:JSON.stringify(t)})}async function c(e){await a.hdel(s,e)}async function l(){let e=await a.hgetall(s),t={};for(let[r,a]of Object.entries(e??{}))"string"==typeof a&&(t[r]=JSON.parse(a));return t}async function u(){return Object.keys(await a.hgetall(s)??{}).length}async function p(){return await a.get(o)??{}}async function f(e){await a.set(o,e)}async function d(){return await a.get(i)??{}}async function m(e){await a.set(i,e)}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[948,972,343,615,433,152],()=>r(70260));module.exports=a})();