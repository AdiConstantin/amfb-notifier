(()=>{var e={};e.id=925,e.ids=[925],e.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},50852:e=>{"use strict";e.exports=require("async_hooks")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},6005:e=>{"use strict";e.exports=require("node:crypto")},84492:e=>{"use strict";e.exports=require("node:stream")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},63477:e=>{"use strict";e.exports=require("querystring")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},87529:()=>{},27828:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>_,patchFetch:()=>D,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>E});var s={};r.r(s),r.d(s,{POST:()=>f});var i=r(49303),o=r(88716),n=r(60670),a=r(87070),c=r(21067),u=r(95908),l=r(18867);let p=c.Ry({email:c.Z_().email(),teams:c.IX(c.Z_()).min(1,"Selectează cel puțin o echipă")});async function f(e){let t=await e.json();console.log("\uD83D\uDCE5 Received subscription request:",t);let r=p.safeParse(t);if(!r.success)return console.error("❌ Schema validation failed:",r.error),a.NextResponse.json({error:r.error.flatten()},{status:400});let s=r.data;console.log("✅ Parsed data:",s);let i=s.email;try{await (0,u.VF)(i,{...s,createdAt:Date.now()});let e=!1;if(console.log("\uD83D\uDD11 API Key check:",{exists:!!process.env.RESEND_API_KEY,startsWithRe:process.env.RESEND_API_KEY?.startsWith("re_"),length:process.env.RESEND_API_KEY?.length,key:process.env.RESEND_API_KEY?`${process.env.RESEND_API_KEY.substring(0,10)}...`:"none"}),process.env.RESEND_API_KEY&&process.env.RESEND_API_KEY.startsWith("re_")&&process.env.RESEND_API_KEY.length>10){console.log("✅ Attempting to send email...");try{e=await (0,l.Xt)(s.email,s.teams),console.log("\uD83D\uDCE7 Email send result:",e)}catch(e){console.error("❌ Email sending failed:",e)}}else console.log("❌ Resend API key not configured properly");return a.NextResponse.json({ok:!0,message:e?"✅ Abonare confirmată! Verifică emailul pentru confirmare.":"✅ Abonare \xeenregistrată cu succes! (Email de confirmare dezactivat temporar)"})}catch(e){return console.error("Subscription error:",e),a.NextResponse.json({error:"Eroare la salvarea abonării"},{status:500})}}let d=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/subscribe/route",pathname:"/api/subscribe",filename:"route",bundlePath:"app/api/subscribe/route"},resolvedPagePath:"D:\\git\\amfb-notifier\\app\\api\\subscribe\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:E,serverHooks:g}=d,_="/api/subscribe/route";function D(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:E})}},18867:(e,t,r)=>{"use strict";r.d(t,{Xt:()=>a,sj:()=>u});var s=r(53194),i=r(5558),o=r.n(i);let n=process.env.RESEND_API_KEY?new s.R(process.env.RESEND_API_KEY):null;async function a(e,t){if(!n)return console.log("❌ Resend not configured"),!1;let r=`[AMFB] Confirmare abonare - Notificări program`,s=t.join(", "),i=`Salut!

Abonarea ta la notificările AMFB a fost \xeenregistrată cu succes!

Echipele pentru care vei primi notificări: ${s}

Vei fi notificat c\xe2nd se schimbă programul pentru aceste echipe.

Pentru a te dezabona, accesează: https://amfb-notifier.vercel.app

Mulțumim!
Echipa AMFB Notifier`;try{console.log("\uD83D\uDCE7 Sending email to:",e),console.log("\uD83D\uDCE7 From:",process.env.RESEND_FROM),console.log("\uD83D\uDCE7 API Key exists:",!!process.env.RESEND_API_KEY),console.log("\uD83D\uDCE7 Teams:",t);let s=await n.emails.send({from:process.env.RESEND_FROM||"AMFB Notifier <onboarding@resend.dev>",to:e,subject:r,text:i});if(console.log("✅ Email API response:",JSON.stringify(s,null,2)),s&&s.data&&s.data.id)return console.log("✅ Email sent successfully with ID:",s.data.id),!0;return console.error("⚠️ Unexpected email response:",s),!1}catch(e){return console.error("❌ Failed to send email:",e),console.error("❌ Error details:",JSON.stringify(e,null,2)),!1}}async function c(e,t,r){if(!n)return;let s=`[AMFB] Program actualizat pentru ${t}`,i=r.map(e=>`• ${t} vs ${e.opponent} - ${new Date(e.dateISO).toLocaleString("ro-RO")}`).join("\n");await n.emails.send({from:process.env.RESEND_FROM||"AMFB Notifier <notify@adrianconstantin.ro>",to:e,subject:s,text:`S-au detectat schimbări:
${i}

Link: https://amfb.ro/competitii/campionat-minifotbal/grupa-2013-albastru/`})}async function u(e,t){for(let[,r]of Object.entries(e))for(let e of r.teams){let s=t[e];s?.length&&r.email&&await c(r.email,e,s)}}process.env.TWILIO_SID&&process.env.TWILIO_TOKEN&&o()(process.env.TWILIO_SID,process.env.TWILIO_TOKEN)},95908:(e,t,r)=>{"use strict";r.d(t,{AL:()=>c,VF:()=>a,VR:()=>p,Yo:()=>d,cg:()=>f,f7:()=>u,tv:()=>m,wA:()=>l});let s=new(r(46343)).s({url:process.env.KV_REST_API_URL,token:process.env.KV_REST_API_TOKEN}),i="subs",o="last_fixtures",n="last_fixtures_full";async function a(e,t){await s.hset(i,{[e]:JSON.stringify(t)})}async function c(e){await s.hdel(i,e)}async function u(){let e=await s.hgetall(i),t={};for(let[r,s]of Object.entries(e??{}))"string"==typeof s&&(t[r]=JSON.parse(s));return t}async function l(){return Object.keys(await s.hgetall(i)??{}).length}async function p(){return await s.get(o)??{}}async function f(e){await s.set(o,e)}async function d(){return await s.get(n)??{}}async function m(e){await s.set(n,e)}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,972,343,615,433,67],()=>r(27828));module.exports=s})();